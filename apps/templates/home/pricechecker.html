{% extends "layouts/base.html" %} {% block title %} Sample Page {% endblock %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}{% endblock stylesheets %} {% block content %}

<!-- [ Main Content ] start -->
<div class="pcoded-main-container">
    <div class="pcoded-content">
        <!-- [ breadcrumb ] start -->
        <div class="page-header">
            <div class="page-block">
                <div class="row align-items-center">
                    <div class="col-md-12">
                        <div class="page-header-title">
                            <h5 class="m-b-10">Price Checker</h5>
                        </div>
                        <ul class="breadcrumb">
                            <li class="breadcrumb-item"><a href="index.html"><i class="feather icon-home"></i></a></li>
                            <li class="breadcrumb-item"><a href="#!">Price Checker</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- [ breadcrumb ] end -->
        <!-- [ Main Content ] start -->
        <div class="row">
            <!-- [ sample-page ] start -->
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Search for food</h5>
                        <button type="button" id="viewListBtn" class="btn btn-primary float-right" data-toggle="modal" data-target="#shoppingListModal">View Shopping List</button>
                        <div id="shoppingListModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="shoppingListModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLiveLabel">Shopping List</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="table-responsive">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th>Food Item</th>
                                                        <th>Price</th>
                                                        <th>Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="shoppingList">
                                                    <tr>
                                                        <td>Mark</td>
                                                        <td>Otto</td>
                                                        <td>
                                                            <button type="button" class="btn  btn-icon btn-outline-danger"><i class="feather icon-x"></i></button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>Jacob</td>
                                                        <td>Thornton</td>
                                                        <td></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Larry</td>
                                                        <td>the Bird</td>
                                                        <td></td>
                                                    </tr>
                                                </tbody>
                                                <tfoot>
                                                    <tr>
                                                        <td>Total Amount:</td>
                                                        <td>$<span id="totalAmt"></span></td>
                                                        <td></td>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn  btn-secondary" data-dismiss="modal">Close</button>
                                        <button type="button" class="btn  btn-success">Checkout</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body table-border-style">
                        <div class="input-group input-group-button mb-3">
                            <input type="text" id="search" class="form-control" placeholder="Search for your food item">
                        </div>
                        <div class="table-responsive">
                            <table id="foodTable" class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Food Item</th>
                                        <th>Price</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in food_items %}
                                    <tr>
                                        <td>{{ item[0] }}</td>
                                        <td>{{ item[1] }} ({{ item[3] }}g)</td>
                                        <td>${{ item[2] }}</td>
                                        <td>
                                            <button type="button" data-fid="{{ item[0] }}" data-name="{{ item[1] }}" data-weight="{{ item[3] }}" data-price="{{ item[2] }}" class="btn  btn-icon btn-outline-success addBtn"><i class="feather icon-plus"></i></button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!-- [ sample-page ] end -->
        </div>
        <!-- [ Main Content ] end -->
    </div>
</div>
<!-- [ Main Content ] end -->

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
<script>
    food_items = [];

    $(document).ready(function() {
        $("#search").on("keyup", function() {
            var value = $(this).val().toLowerCase();
            $("#foodTable tr").filter(function() {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    });;

    $(".addBtn").click(function() {
        var food_item = {
            id: "",
            fid: $(this).data('fid'),
            food_name: $(this).data('name'),
            weight: $(this).data('weight'),
            price: $(this).data('price')
        };

        if (localStorage.getItem("food_items") == null) {
            food_items[0] = food_item;
            localStorage.setItem("food_items", JSON.stringify(food_items));
            food_item.id = 0;
        } else {
            food_items = JSON.parse(localStorage.getItem("food_items"));
            food_items[food_items.length] = food_item;
            food_items[0].id = 1;
            food_item.id = food_items.length;
            localStorage.setItem("food_items", JSON.stringify(food_items));
        }
        alert("Item added!");
        console.log(food_items);
    });

    $("#viewListBtn").click(function() {
        var food_items = JSON.parse(localStorage.getItem("food_items"));

        $("#shoppingList").empty();
        $("#totalAmt").empty();

        totalAmt = 0;

        if (totalAmt == 0) {
            $("#totalAmt").append("0");
        }

        food_items.forEach(function(food_item, index) {
            $("#shoppingList").append("<tr><td>" + food_item.food_name + " (" + food_item.weight + "g) " + "</td><td>$" +
                food_item.price + "</td><td><button type='button' data-id='" + food_item.id + "' class='btn btn-icon btn-outline-danger deleteBtn'><i class='feather icon-x'></i></button></tr>");

            totalAmt += food_item.price;
        });

        $("#totalAmt").empty();
        $("#totalAmt").append(totalAmt.toFixed(2));

        $(".deleteBtn").click(function() {
            food_items = JSON.parse(localStorage.getItem("food_items"));

            var id = $(this).data('id');
            var food_index = 0;

            food_items.forEach((element, index, array) => {
                if (element["id"] == id) {
                    food_index = index;
                }
            });

            var currentAmt = food_items[food_index].price;

            food_items.splice(food_index, 1);
            localStorage.setItem("food_items", JSON.stringify(food_items));
            totalAmt -= currentAmt;

            $(this).closest('tr').remove();
            $("#totalAmt").empty();
            $("#totalAmt").append(totalAmt.toFixed(2));
        });
    });
</script>
{% endblock javascripts %}